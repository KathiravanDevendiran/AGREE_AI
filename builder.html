<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AgriStack Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <script src="main.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <h1>ğŸŒ¾ AgriStack Dashboard</h1>
        <p>à®µà®¿à®µà®šà®¾à®¯ à®¨à®¿à®²à®¤à¯à®¤à®¿à®©à¯ à®¨à®¿à®²à¯ˆà®®à¯ˆà®¯à¯ˆ à®ªà®¾à®°à¯à®™à¯à®•à®³à¯!</p>
    </div>
    <div class="dashboard-layout">
        <nav class="sidebar">
            <ul>
                <li class="active" id="nav-overview">Overview</li>
                <li id="nav-weather">Weather</li>
                <li id="nav-tasks">Tasks</li>
                <li id="nav-soil">Soil</li>
                <li id="nav-irrigation">Irrigation</li>
                <li id="nav-yield">Yield</li>
                <li id="nav-defect">Crop Defect Detection</li>
                <li id="nav-map">Map</li>
            </ul>
        </nav>
        <main>
            <div class="dashboard-section" id="section-overview">
                <div class="section-card">
                    <label for="fieldSelect">Select Field:</label>
                    <select id="fieldSelect">
                        <option>Field 1</option>
                        <option>Field 2</option>
                        <option>Field 3</option>
                    </select>
                    <div class="field-status">
                        <h2>Field Health Summary</h2>
                        <p>ğŸ›° NDVI: <strong id="ndviVal">0.72</strong> â€“ Healthy ğŸŒ¿</p>
                        <p>ğŸ’§ Water Stress: <strong id="waterVal">Low</strong></p>
                        <p>ğŸŒ¡ï¸ Temperature: <strong id="tempVal">28Â°C</strong></p>
                        <p>ğŸŒ§ï¸ Rainfall (last 24h): <strong id="rainVal">12mm</strong></p>
                        <p>ğŸ› Pest Alert: <strong id="pestVal">None</strong></p>
                        <p id="aiVal">AI Suggestion: â€œà®¨à¯€à®°à¯ à®…à®³à®µà¯ˆ à®šà¯€à®°à®¾à®• à®ªà®°à®¾à®®à®°à®¿à®•à¯à®•à®µà¯à®®à¯.â€</p>
                    </div>
                </div>
                <div class="section-card chart-container" style="width: 100%; max-width: 500px;">
                    <canvas id="ndviChart"></canvas>
                </div>
            </div>
            <div class="dashboard-section" id="section-weather" style="display:none;">
                <div class="section-card weather-widget">
                    <h3>3-Day Weather Forecast</h3>
                    <ul id="weatherForecast">
                        <li>Mon: â˜€ï¸ 30Â°C</li>
                        <li>Tue: ğŸŒ¦ï¸ 28Â°C</li>
                        <li>Wed: ğŸŒ§ï¸ 26Â°C</li>
                    </ul>
                </div>
            </div>
            <div class="dashboard-section" id="section-tasks" style="display:none;">
                <div class="section-card task-list">
                    <h3>Today's Tasks</h3>
                    <input type="text" id="taskInput" placeholder="Add new task..." />
                    <button id="addTaskBtn">Add</button>
                    <ul id="tasks"></ul>
                </div>
            </div>
            <div class="dashboard-section" id="section-soil" style="display:none;">
                <div class="section-card soil-quality">
                    <h3>Soil Quality</h3>
                    <p>pH: <strong id="phVal">6.8</strong></p>
                    <p>Nitrogen: <strong id="nVal">High</strong></p>
                    <p>Phosphorus: <strong id="pVal">Medium</strong></p>
                    <p>Potassium: <strong id="kVal">Low</strong></p>
                </div>
            </div>
            <div class="dashboard-section" id="section-irrigation" style="display:none;">
                <div class="section-card irrigation-scheduler">
                    <h3>Irrigation Scheduler</h3>
                    <p>Next irrigation: <strong>Tomorrow, 6:00 AM</strong></p>
                    <button>View Schedule</button>
                </div>
            </div>
            <div class="dashboard-section" id="section-yield" style="display:none;">
                <div class="section-card yield-prediction">
                    <h3>Yield Prediction</h3>
                    <p>Estimated Yield: <strong>3.2 tons/acre</strong></p>
                </div>
            </div>
            <div class="dashboard-section" id="section-defect" style="display:none;">
                <div class="section-card defect-detection">
                    <h3>ğŸ” Crop Defect Detection</h3>
                    <div class="upload-area">
                        <input type="file" id="cropImage" accept="image/*" style="display:none;">
                        <button id="uploadBtn" class="upload-button">ğŸ“· Upload Crop Image</button>
                        <div id="imagePreview" style="display:none;">
                            <img id="previewImg" style="max-width:300px;border-radius:8px;margin:10px 0;">
                            <button id="analyzeBtn" class="analyze-button">ğŸ”¬ Analyze Defects</button>
                        </div>
                    </div>
                    <div id="analysisResults" style="display:none;">
                        <h4>ğŸ¯ Detection Results</h4>
                        <div id="defectsList"></div>
                        <h4>ğŸ’¡ Recommended Solutions</h4>
                        <div id="solutionsList"></div>
                    </div>
                </div>
            </div>
            <div class="dashboard-section" id="section-map" style="display:none;">
                <div class="section-card field-map">
                    <h3>Field Map</h3>
                    <img src="field-map-demo.png" alt="Field Map" style="width:100%;border-radius:8px;">
                </div>
            </div>
        </main>
    </div>
    <footer>
        <p>&copy; 2025 AgriStack. All rights reserved.</p>
    </footer>
    <script>
        // Check authentication
        if (!localStorage.getItem('userLoggedIn') || !localStorage.getItem('setupComplete')) {
            window.location.href = 'index.html';
        }

        // Load farm data from setup
        const farmData = JSON.parse(localStorage.getItem('farmData') || '{}');
        
        const fieldData = {
    "Field 1": {
        ndvi: 0.72, water: "Low", temp: "28Â°C", rain: "12mm", pest: "None", ai: "à®¨à¯€à®°à¯ à®…à®³à®µà¯ˆ à®šà¯€à®°à®¾à®• à®ªà®°à®¾à®®à®°à®¿à®•à¯à®•à®µà¯à®®à¯.",
        chart: [0.65, 0.68, 0.7, 0.72, 0.71, 0.73, 0.72]
    },
    "Field 2": {
        ndvi: 0.55, water: "Medium", temp: "31Â°C", rain: "5mm", pest: "Mild", ai: "à®ªà¯‚à®šà¯à®šà®¿ à®®à¯‡à®²à®¾à®£à¯à®®à¯ˆ à®šà¯†à®¯à¯à®¯à®µà¯à®®à¯.",
        chart: [0.5, 0.52, 0.54, 0.55, 0.56, 0.57, 0.55]
    },
    "Field 3": {
        ndvi: 0.40, water: "High", temp: "26Â°C", rain: "20mm", pest: "High", ai: "à®¨à¯€à®°à¯ à®…à®³à®µà¯ˆ à®•à¯à®±à¯ˆà®•à¯à®•à®µà¯à®®à¯.",
        chart: [0.45, 0.43, 0.42, 0.40, 0.41, 0.39, 0.40]
    }
};

let chartInstance;

window.addEventListener('DOMContentLoaded', () => {
    // Update field selector with user's fields
    const select = document.getElementById('fieldSelect');
    select.innerHTML = '';
    
    if (farmData.fields) {
        farmData.fields.forEach(field => {
            const option = document.createElement('option');
            option.value = field.name;
            option.textContent = `${field.name} (${field.crop})`;
            select.appendChild(option);
        });
    }
    
    // Update header with farm name
    if (farmData.farmName) {
        document.querySelector('.header h1').textContent = `ğŸŒ¾ ${farmData.farmName}`;
    }
    const ndvi = document.querySelector('.field-status strong:nth-child(1)');
    const water = document.querySelector('.field-status p:nth-child(3) strong');
    const temp = document.querySelector('.field-status p:nth-child(4) strong');
    const rain = document.querySelector('.field-status p:nth-child(5) strong');
    const pest = document.querySelector('.field-status p:nth-child(6) strong');
    const ai = document.querySelector('.field-status p:nth-child(7)');
    const ctx = document.getElementById('ndviChart').getContext('2d');

    // Initial chart
    chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'NDVI',
                data: fieldData["Field 1"].chart,
                borderColor: 'green',
                fill: false
            }]
        }
    });

    select.addEventListener('change', () => {
        const data = fieldData[select.value];
        ndvi.textContent = data.ndvi;
        water.textContent = data.water;
        temp.textContent = data.temp;
        rain.textContent = data.rain;
        pest.textContent = data.pest;
        ai.innerHTML = `AI Suggestion: â€œ${data.ai}â€`;
        chartInstance.data.datasets[0].data = data.chart;
        chartInstance.update();
    });

    // Task list logic
    const taskInput = document.getElementById('taskInput');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const tasksUl = document.getElementById('tasks');

    addTaskBtn.addEventListener('click', () => {
        if (taskInput.value.trim() !== "") {
            const li = document.createElement('li');
            li.textContent = taskInput.value;
            li.addEventListener('click', () => li.classList.toggle('done'));
            tasksUl.appendChild(li);
            taskInput.value = "";
        }
    });
});

document.addEventListener('DOMContentLoaded', function() {
    const navItems = document.querySelectorAll('.sidebar li');
    const sections = document.querySelectorAll('.dashboard-section');

    navItems.forEach(item => {
        item.addEventListener('click', function() {
            // Remove active class from all
            navItems.forEach(i => i.classList.remove('active'));
            // Add active to clicked
            this.classList.add('active');
            // Hide all sections
            sections.forEach(sec => sec.style.display = 'none');
            // Show the selected section
            const sectionId = 'section-' + this.id.replace('nav-', '');
            const section = document.getElementById(sectionId);
            if (section) section.style.display = '';
        });
    });

    // Crop defect detection functionality
    const uploadBtn = document.getElementById('uploadBtn');
    const cropImage = document.getElementById('cropImage');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const analysisResults = document.getElementById('analysisResults');
    const defectsList = document.getElementById('defectsList');
    const solutionsList = document.getElementById('solutionsList');

    const defectDatabase = {
        'leaf_spot': {
            name: 'Leaf Spot Disease',
            solutions: ['Apply copper-based fungicide', 'Remove affected leaves', 'Improve air circulation']
        },
        'blight': {
            name: 'Blight',
            solutions: ['Use resistant varieties', 'Apply preventive fungicide', 'Ensure proper drainage']
        },
        'pest_damage': {
            name: 'Pest Damage',
            solutions: ['Apply organic pesticide', 'Use beneficial insects', 'Regular monitoring']
        },
        'nutrient_deficiency': {
            name: 'Nutrient Deficiency',
            solutions: ['Apply balanced fertilizer', 'Soil testing recommended', 'Adjust pH levels']
        }
    };

    uploadBtn.addEventListener('click', () => cropImage.click());

    cropImage.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
                analysisResults.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });

    analyzeBtn.addEventListener('click', function() {
        // Simulate AI analysis
        analyzeBtn.textContent = 'ğŸ”„ Analyzing...';
        analyzeBtn.disabled = true;
        
        setTimeout(() => {
            const detectedDefects = ['leaf_spot', 'nutrient_deficiency'];
            
            defectsList.innerHTML = '';
            solutionsList.innerHTML = '';
            
            detectedDefects.forEach(defectKey => {
                const defect = defectDatabase[defectKey];
                
                const defectItem = document.createElement('div');
                defectItem.innerHTML = `<p><strong>âš ï¸ ${defect.name}</strong> - Confidence: ${Math.floor(Math.random() * 20 + 80)}%</p>`;
                defectsList.appendChild(defectItem);
                
                const solutionItem = document.createElement('div');
                solutionItem.innerHTML = `<h5>${defect.name} Solutions:</h5><ul>${defect.solutions.map(sol => `<li>${sol}</li>`).join('')}</ul>`;
                solutionsList.appendChild(solutionItem);
            });
            
            analysisResults.style.display = 'block';
            analyzeBtn.textContent = 'ğŸ”¬ Analyze Defects';
            analyzeBtn.disabled = false;
        }, 2000);
    });
});</script>
</body>
</html>